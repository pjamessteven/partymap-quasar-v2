import{e as q,r as R,br as z,bs as B,bt as D,bj as K,h as F,j as L,k as N,bu as P,bv as I,n as M,bw as Q,bx as U,_ as j,a7 as T,aE as Z,ao as O,I as G,K as Y,M as l,Z as f,au as J,a0 as X,J as C,aN as v,L as x,V as H,z as b,aI as g,$ as W,X as ee,Q as te,a5 as ae,a6 as se}from"./index.458653eb.js";var oe=q({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:c}){const _=N(),o=R(null);let n=0;const u=[];function a(t){const m=typeof t=="boolean"?t:e.noErrorFocus!==!0,h=++n,S=(r,i)=>{c("validation"+(r===!0?"Success":"Error"),i)},$=r=>{const i=r.validate();return typeof i.then=="function"?i.then(d=>({valid:d,comp:r}),d=>({valid:!1,comp:r,err:d})):Promise.resolve({valid:i,comp:r})};return(e.greedy===!0?Promise.all(u.map($)).then(r=>r.filter(i=>i.valid!==!0)):u.reduce((r,i)=>r.then(()=>$(i).then(d=>{if(d.valid===!1)return Promise.reject(d)})),Promise.resolve()).catch(r=>[r])).then(r=>{if(r===void 0||r.length===0)return h===n&&S(!0),!0;if(h===n){const{comp:i,err:d}=r[0];if(d!==void 0&&console.error(d),S(!1,i),m===!0){const k=r.find(({comp:A})=>typeof A.focus=="function"&&P(A.$)===!1);k!==void 0&&k.comp.focus()}}return!1})}function y(){n++,u.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function V(t){t!==void 0&&I(t);const m=n+1;a().then(h=>{m===n&&h===!0&&(e.onSubmit!==void 0?c("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function w(t){t!==void 0&&I(t),c("reset"),M(()=>{y(),e.autofocus===!0&&e.noResetFocus!==!0&&p()})}function p(){Q(()=>{if(o.value===null)return;const t=o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),m=>m.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}z(U,{bindComponent(t){u.push(t)},unbindComponent(t){const m=u.indexOf(t);m>-1&&u.splice(m,1)}});let E=!1;return B(()=>{E=!0}),D(()=>{E===!0&&e.autofocus===!0&&p()}),K(()=>{e.autofocus===!0&&p()}),Object.assign(_.proxy,{validate:a,resetValidation:y,submit:V,reset:w,focus:p,getValidationComponents:()=>u}),()=>F("form",{class:"q-form",ref:o,onSubmit:V,onReset:w},L(s.default))}});const re={name:"RegisterPage",data(){return{username:"",password:"",password_confirm:"",email:"",loading:!1,username_taken:!1,email_taken:!1}},components:{InnerLoading:T},methods:{...Z(O,["register"]),async _register(){this.loading=!0;try{await this.register({email:this.email,password:this.password,username:this.username,token:this.$route.params&&this.$route.params.token?this.$route.params.token:void 0}),this.$q.dialog({title:this.$t("auth.account_created"),message:this.$t("auth.account_created_msg"),color:"primary"}).onOk(()=>{this.$router.replace("/login")}).onCancel(()=>{this.$router.replace("/login")}).onDismiss(()=>{this.$router.replace("/login")})}catch(e){this.loading=!1,e.response.data.error.code==="USERNAME_TAKEN"?this.username_taken=!0:e.response.data.error.code==="EMAIL_ALREADY_REGISTERED"&&(this.email_taken=!0)}},hideDialog(){this.$router.push({name:"Explore"})},usernameValidation(e){return this.username_taken?this.$t("error_codes.USERNAME_TAKEN"):e.length>25?this.$t("validation.username_too_long"):e.length<3?this.$t("validation.username_too_short"):/^[A-Za-z0-9_-]+$/.test(e)?!0:this.$t("auth.username_letters_and_numbers")},passwordValidation(e){return e.length>72?this.$t("validation.password_too_long"):e.length<8?this.$t("validation.password_too_short"):!0},passwordConfirmValidation(e){return this.password!==e?this.$t("validation.password_must_match"):!0},emailValidation(e){return this.email_taken?this.$t("error_codes.EMAIL_ALREADY_REGISTERED"):/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)?!0:this.$t("validation.email_invalid")}},watch:{username(){this.username_taken&&(this.username_taken=!1)},email(){this.email_taken&&(this.email_taken=!1)}},computed:{validation(){return!(this.usernameValidation===""&&this.passwordValidation===""&&this.emailValidation)}}},ne=e=>(ae("data-v-61fea2c5"),e=e(),se(),e),ie=ne(()=>x("div",{class:"header t1 inter bolder text-h5 q-my-lg",style:{"text-align":"center","text-transform":"capitalize"}}," Create account ",-1)),le={class:"t3"};function ue(e,s,c,_,o,n){const u=G("InnerLoading");return C(),Y("div",{class:"dialog-page",onClick:s[8]||(s[8]=X(a=>e.$router.go(-1),["self"]))},[l(J,{bordered:e.$q.screen.gt.sm,class:"auth-card"},{default:f(()=>[l(v,{style:{"text-align":"center"}},{default:f(()=>[ie,x("p",le,H(e.$t("auth.choose_username_message")),1)]),_:1}),l(oe,{onSubmit:n._register},{default:f(()=>[l(v,{class:"form q-px-lg q-pt-none"},{default:f(()=>[l(b,{outlined:"",autocapitalize:"off",filled:"","hide-bottom-space":"",label:e.$t("auth.username"),modelValue:o.username,"onUpdate:modelValue":s[0]||(s[0]=a=>o.username=a),onKeyup:s[1]||(s[1]=g(a=>e.prompt=!1,["enter"])),"bottom-slots":"","lazy-rules":"",rules:[a=>n.usernameValidation(a)]},null,8,["label","modelValue","rules"]),l(b,{outlined:"",filled:"",autocapitalize:"off",class:"q-mt-md",type:"email","hide-bottom-space":"",label:e.$t("auth.email"),modelValue:o.email,"onUpdate:modelValue":s[2]||(s[2]=a=>o.email=a),onKeyup:s[3]||(s[3]=g(a=>e.prompt=!1,["enter"])),"bottom-slots":"",rules:[a=>n.emailValidation(a)]},null,8,["label","modelValue","rules"]),l(b,{outlined:"",filled:"",class:"q-mt-md","hide-bottom-space":"",label:e.$t("auth.password"),type:"password",modelValue:o.password,"onUpdate:modelValue":s[4]||(s[4]=a=>o.password=a),onKeyup:s[5]||(s[5]=g(a=>e.prompt=!1,["enter"])),"bottom-slots":"",rules:[a=>n.passwordValidation(a)]},null,8,["label","modelValue","rules"]),l(b,{outlined:"",filled:"",class:"q-mt-md","hide-bottom-space":"",label:e.$t("auth.password_confirm"),type:"password",modelValue:o.password_confirm,"onUpdate:modelValue":s[6]||(s[6]=a=>o.password_confirm=a),onKeyup:s[7]||(s[7]=g(a=>e.prompt=!1,["enter"])),"bottom-slots":"",rules:[a=>n.passwordConfirmValidation(a)]},null,8,["label","modelValue","rules"]),o.loading?(C(),W(u,{key:0,solid:!0})):ee("",!0)]),_:1}),l(v,{class:"flex justify-center q-mb-md q-px-lg"},{default:f(()=>[l(te,{class:"inter bold",disable:o.loading,label:"Sign up!","no-caps":"",color:"primary",size:"",type:"submit"},null,8,["disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["bordered"])])}var fe=j(re,[["render",ue],["__scopeId","data-v-61fea2c5"]]);export{fe as default};
